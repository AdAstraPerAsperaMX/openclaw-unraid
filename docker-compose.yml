version: "3.8"

services:
  openclaw:
    image: ghcr.io/openclaw/openclaw:latest
    container_name: openclaw-gateway
    hostname: ${HOSTNAME:-openclaw}
    restart: unless-stopped
    network_mode: host
    # Runs as 'node' user (UID 1000) - do NOT add user: root
    
    volumes:
      # Config and state (openclaw.json, sessions, media)
      # IMPORTANT: Must be owned by UID 1000
      - /mnt/user/appdata/openclaw/config:/home/node/.openclaw:rw
      # Agent workspace (SOUL.md, MEMORY.md, skills)
      - /mnt/user/appdata/openclaw/workspace:/home/node/clawd:rw
      # Optional: Projects directory
      # - /mnt/user/projects:/projects:rw
    
    environment:
      - TZ=America/Chicago
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN:-change-me}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      # - OPENAI_API_KEY=${OPENAI_API_KEY}
    
    command: ["node", "dist/index.js", "gateway"]
    
    logging:
      driver: json-file
      options:
        max-size: "50m"
        max-file: "1"

# ==============================================================================
# FIRST TIME SETUP
# ==============================================================================
#
# 1. Create directories:
#    mkdir -p /mnt/user/appdata/openclaw/{config,workspace}
#
# 2. Create config file at /mnt/user/appdata/openclaw/config/openclaw.json:
#    {
#      "gateway": {
#        "mode": "local",
#        "bind": "lan",
#        "auth": { "token": "${OPENCLAW_GATEWAY_TOKEN}" }
#      },
#      "agents": {
#        "defaults": { "workspace": "/home/node/clawd" }
#      }
#    }
#
# 3. Fix permissions (container runs as UID 1000):
#    chown -R 1000:1000 /mnt/user/appdata/openclaw
#
# 4. Create .env file with your keys:
#    OPENCLAW_GATEWAY_TOKEN=your-secret-token
#    ANTHROPIC_API_KEY=sk-ant-...
#
# 5. Start:
#    docker compose up -d
#
# 6. Access Web UI:
#    http://YOUR-IP:18789?token=YOUR_TOKEN
#
# ==============================================================================
